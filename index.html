<!DOCTYPE html>
<html lang="english">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Dev log</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Dev log</a></h1>
                <nav><ul>
                    <li><a href="/category/misc.html">misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/sql-queries-in-pandas.html">SQL Queries in Pandas</a></h1>
<footer class="post-info">
        <abbr class="published" title="2023-09-10T00:00:00-05:00">
                Published: Sun 10 September 2023
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/dev.html">dev</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>.</p>
<p>tags: <a href="/tag/pandas.html">Pandas</a> <a href="/tag/duckdb.html">DuckDB</a> </p>
</footer><!-- /.post-info --><p>I spend a lot of development time in PySpark applications and like to use SparkSQL for transformations. It is very easy to run SparkSQL queries on a Spark DataFrame. </p>
<div class="highlight"><pre><span></span><code><span class="n">source_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">source_df</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="k">source</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span>
</code></pre></div>

<p>I have several projects that use Pandas and I want a similar workflow. Why bother learning the Pandas API for transformations when SQL is more elegant and evergreen? Many resources online recommend to use <a href="https://pypi.org/project/pandasql/">pandassql</a>. Unfortunately it has not been updated in over 7 years and it does not work. </p>
<p>I learned that <a href="https://duckdb.org/2021/05/14/sql-on-pandas.html">DuckDB</a> is a better approach. </p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">duckdb</span>

<span class="n">source</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sql</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>

<span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT *</span>
<span class="s2">    FROM source</span>
<span class="s2">    LIMIT 10</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div>

<p>It is able to recognize existing dataframes by name and execute plain SQL. The result of my <code>sql</code> function returns a Pandas DataFrame that also be referenced by future <code>sql</code> calls. </p>
<div class="highlight"><pre><span></span><code><span class="n">clean_source</span> <span class="o">=</span> <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT *</span>
<span class="s2">    FROM source</span>
<span class="s2">    WHERE id &gt; 0</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT *</span>
<span class="s2">    FROM clean_source</span>
<span class="s2">    LIMIT 10</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/trafilatura-starter.html" rel="bookmark"
                           title="Permalink to Trafilatura Starter">Trafilatura Starter</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2023-09-10T00:00:00-05:00">
                Published: Sun 10 September 2023
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/dev.html">dev</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>.</p>
<p>tags: <a href="/tag/trafilatura.html">Trafilatura</a> </p>
</footer><!-- /.post-info -->                <p>In a previous post I mentioned using Trafilatura in an AWS Lambda function. Trafilatura's main purpose is to easily extract metadata from websites. All web crawling info and web document traversal are abstracted away from the user.</p>
<p>Basic usage:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">trafilatura</span> <span class="kn">import</span> <span class="n">fetch_url</span>
<span class="kn">from</span> <span class="nn">trafilatura</span> <span class="kn">import</span> <span class="n">extract</span><span class="p">,</span> <span class="n">extract_metadata</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">document …</span></code></pre></div>
                <a class="readmore" href="/trafilatura-starter.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/creating-mock-api-outputs-in-an-expo-react-native-app.html" rel="bookmark"
                           title="Permalink to Creating mock API outputs in an Expo React Native app">Creating mock API outputs in an Expo React Native app</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2023-09-09T00:00:00-05:00">
                Published: Sat 09 September 2023
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/dev.html">dev</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>.</p>
<p>tags: <a href="/tag/expo.html">Expo</a> <a href="/tag/reactnative.html">ReactNative</a> </p>
</footer><!-- /.post-info -->                <p>I am currently working on an Expo React Native app and need to call different paid APIs to get data. There are times when I want to update how the data is rendered in the application or the application logic flow. These develepment tasks, especially UI updates, can be a …</p>
                <a class="readmore" href="/creating-mock-api-outputs-in-an-expo-react-native-app.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/getting-started-with-osm.html" rel="bookmark"
                           title="Permalink to Getting started with OSM">Getting started with OSM</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2023-09-02T00:00:00-05:00">
                Published: Sat 02 September 2023
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/dev.html">dev</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>.</p>
<p>tags: <a href="/tag/osm.html">OSM</a> </p>
</footer><!-- /.post-info -->                <p>I have recently been interested in open source mapping and started to contribute to Open Street Map.</p>
<p><strong><a href="https://maproulette.org/">Map Roulette</a></strong> contains different challenges. Right now I do very basic challenges that fix metadata about a location such as phone numbers or websites. There are more complex channels where you need to …</p>
                <a class="readmore" href="/getting-started-with-osm.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/trafilatura-aws-lambda-layer.html" rel="bookmark"
                           title="Permalink to Trafilatura AWS Lambda Layer">Trafilatura AWS Lambda Layer</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2023-08-30T00:00:00-05:00">
                Published: Wed 30 August 2023
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/dev.html">dev</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>.</p>
<p>tags: <a href="/tag/aws-lambda.html">AWS Lambda</a> <a href="/tag/trafilatura.html">Trafilatura</a> </p>
</footer><!-- /.post-info -->                <p>I want to create an AWS Lambda function that can extract the text from a web article. One way to do this is to create a Lambda Layer with the required package dependencies and then have a Lambda function connect to the Lambda Layer and execute the extraction code. </p>
<p>I …</p>
                <a class="readmore" href="/trafilatura-aws-lambda-layer.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>